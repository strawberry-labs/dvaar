# =============================================================================
# Dvaar Caddy Configuration
# Uses Cloudflare Origin Certificate for tunnel domains
# =============================================================================

# API endpoint (api.dvaar.io)
api.{$BASE_DOMAIN:dvaar.io} {
    reverse_proxy dvaar:8080
}

# Admin panel (admin.dvaar.io)
admin.{$BASE_DOMAIN:dvaar.io} {
    reverse_proxy dvaar:8080
}

# User dashboard (dash.dvaar.io)
dash.{$BASE_DOMAIN:dvaar.io} {
    reverse_proxy dvaar:8080
}

# Tunnel subdomains (*.dvaar.app) - uses Cloudflare Origin Certificate
*.{$TUNNEL_DOMAIN:dvaar.app} {
    tls /etc/caddy/certs/origin.pem /etc/caddy/certs/origin-key.pem
    reverse_proxy dvaar:8080
}

# Root tunnel domain redirect (dvaar.app -> dvaar.io)
{$TUNNEL_DOMAIN:dvaar.app} {
    tls /etc/caddy/certs/origin.pem /etc/caddy/certs/origin-key.pem
    redir https://{$BASE_DOMAIN:dvaar.io}{uri} permanent
}
