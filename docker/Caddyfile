# =============================================================================
# Dvaar Caddy Configuration
# BASE_DOMAIN: dvaar.io (main site, API, admin, dashboard)
# TUNNEL_DOMAIN: dvaar.app (user tunnel URLs)
# =============================================================================

# Main site + API (dvaar.io)
{$BASE_DOMAIN:dvaar.io} {
    reverse_proxy dvaar:8080
}

# API endpoint (api.dvaar.io)
api.{$BASE_DOMAIN:dvaar.io} {
    reverse_proxy dvaar:8080
}

# Admin panel (admin.dvaar.io)
admin.{$BASE_DOMAIN:dvaar.io} {
    reverse_proxy dvaar:8080
}

# User dashboard (dash.dvaar.io)
dash.{$BASE_DOMAIN:dvaar.io} {
    reverse_proxy dvaar:8080
}

# Wildcard for tunnel subdomains (*.dvaar.app)
*.{$TUNNEL_DOMAIN:dvaar.app} {
    reverse_proxy dvaar:8080
}

# Root tunnel domain redirect (dvaar.app -> dvaar.io)
{$TUNNEL_DOMAIN:dvaar.app} {
    redir https://{$BASE_DOMAIN:dvaar.io}{uri} permanent
}
